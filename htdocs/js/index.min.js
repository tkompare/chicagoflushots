var saveAs=saveAs||function(a){"use strict";if(!(void 0===a||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(a){var b=new MouseEvent("click");a.dispatchEvent(b)},g=/constructor/i.test(a.HTMLElement)||a.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent),i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=4e4,l=function(a){var b=function(){"string"==typeof a?c().revokeObjectURL(a):a.remove()};setTimeout(b,k)},m=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(a){i(a)}}},n=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a},o=function(b,i,k){k||(b=n(b));var o,p=this,q=b.type,r=q===j,s=function(){m(p,"writestart progress write writeend".split(" "))},t=function(){if((h||r&&g)&&a.FileReader){var d=new FileReader;return d.onloadend=function(){var b=h?d.result:d.result.replace(/^data:[^;]*;/,"data:attachment/file;");a.open(b,"_blank")||(a.location.href=b),b=void 0,p.readyState=p.DONE,s()},d.readAsDataURL(b),void(p.readyState=p.INIT)}if(o||(o=c().createObjectURL(b)),r)a.location.href=o;else{a.open(o,"_blank")||(a.location.href=o)}p.readyState=p.DONE,s(),l(o)};if(p.readyState=p.INIT,e)return o=c().createObjectURL(b),void setTimeout(function(){d.href=o,d.download=i,f(d),s(),l(o),p.readyState=p.DONE});t()},p=o.prototype,q=function(a,b,c){return new o(a,b||a.name||"download",c)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(a,b,c){return b=b||a.name||"download",c||(a=n(a)),navigator.msSaveOrOpenBlob(a,b)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs});var ics=function(a,b){"use strict";if(!(navigator.userAgent.indexOf("MSIE")>-1&&-1==navigator.userAgent.indexOf("MSIE 10"))){void 0===a&&(a="default"),void 0===b&&(b="Calendar");var c=(navigator.appVersion.indexOf("Win"),"\r\n"),d=[],e=["BEGIN:VCALENDAR","PRODID:"+b,"VERSION:2.0"].join(c),f=c+"END:VCALENDAR",g=["SU","MO","TU","WE","TH","FR","SA"];return{events:function(){return d},calendar:function(){return e+c+d.join(c)+f},addEvent:function(b,e,f,h,i,j){if(void 0===b||void 0===e||void 0===f||void 0===h||void 0===i)return!1;if(j&&!j.rrule){if("YEARLY"!==j.freq&&"MONTHLY"!==j.freq&&"WEEKLY"!==j.freq&&"DAILY"!==j.freq)throw"Recurrence rrule frequency must be provided and be one of the following: 'YEARLY', 'MONTHLY', 'WEEKLY', or 'DAILY'";if(j.until&&isNaN(Date.parse(j.until)))throw"Recurrence rrule 'until' must be a valid date string";if(j.interval&&isNaN(parseInt(j.interval)))throw"Recurrence rrule 'interval' must be an integer";if(j.count&&isNaN(parseInt(j.count)))throw"Recurrence rrule 'count' must be an integer";if(void 0!==j.byday){if("[object Array]"!==Object.prototype.toString.call(j.byday))throw"Recurrence rrule 'byday' must be an array";if(j.byday.length>7)throw"Recurrence rrule 'byday' array must not be longer than the 7 days in a week";j.byday=j.byday.filter(function(a,b){return j.byday.indexOf(a)==b});for(var k in j.byday)if(g.indexOf(j.byday[k])<0)throw"Recurrence rrule 'byday' values must include only the following: 'SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'"}}var l=new Date(h),m=new Date(i),n=new Date,o=("0000"+l.getFullYear().toString()).slice(-4),p=("00"+(l.getMonth()+1).toString()).slice(-2),q=("00"+l.getDate().toString()).slice(-2),r=("00"+l.getHours().toString()).slice(-2),s=("00"+l.getMinutes().toString()).slice(-2),t=("00"+l.getSeconds().toString()).slice(-2),u=("0000"+m.getFullYear().toString()).slice(-4),v=("00"+(m.getMonth()+1).toString()).slice(-2),w=("00"+m.getDate().toString()).slice(-2),x=("00"+m.getHours().toString()).slice(-2),y=("00"+m.getMinutes().toString()).slice(-2),z=("00"+m.getMinutes().toString()).slice(-2),A=("0000"+n.getFullYear().toString()).slice(-4),B=("00"+(n.getMonth()+1).toString()).slice(-2),C=("00"+n.getDate().toString()).slice(-2),D=("00"+n.getHours().toString()).slice(-2),E=("00"+n.getMinutes().toString()).slice(-2),F=("00"+n.getMinutes().toString()).slice(-2),G="",H="";r+s+t+x+y+z!=0&&(G="T"+r+s+t,H="T"+x+y+z);var I,J=o+p+q+G,K=u+v+w+H,L=A+B+C+"T"+D+E+F;if(j)if(j.rrule)I=j.rrule;else{if(I="rrule:FREQ="+j.freq,j.until){var M=new Date(Date.parse(j.until)).toISOString();I+=";UNTIL="+M.substring(0,M.length-13).replace(/[-]/g,"")+"000000Z"}j.interval&&(I+=";INTERVAL="+j.interval),j.count&&(I+=";COUNT="+j.count),j.byday&&j.byday.length>0&&(I+=";BYDAY="+j.byday.join(","))}(new Date).toISOString();var N=["BEGIN:VEVENT","UID:"+d.length+"@"+a,"CLASS:PUBLIC","DESCRIPTION:"+e,"DTSTAMP;VALUE=DATE-TIME:"+L,"DTSTART;VALUE=DATE-TIME:"+J,"DTEND;VALUE=DATE-TIME:"+K,"LOCATION:"+f,"SUMMARY;LANGUAGE=en-us:"+b,"TRANSP:TRANSPARENT","END:VEVENT"];return I&&N.splice(4,0,I),N=N.join(c),d.push(N),N},download:function(a,b){if(d.length<1)return!1;b=void 0!==b?b:".ics",a=void 0!==a?a:"calendar";var g,h=e+c+d.join(c)+f;if(-1===navigator.userAgent.indexOf("MSIE 10"))g=new Blob([h]);else{var i=new BlobBuilder;i.append(h),g=i.getBlob("text/x-vCalendar;charset="+document.characterSet)}return saveAs(g,a+b),h},build:function(){return!(d.length<1)&&e+c+d.join(c)+f}}}console.log("Unsupported Browser")},Vax={Configs:null,Events:[],Cal:[],Map:null,Markers:[],AddressMarker:null,i:null,loadScript:function(){$.when($.getJSON("js/configure.json",function(a){Vax.Configs=a})).then(function(){var a=document.createElement("script");a.type="text/javascript",a.src="https://maps.googleapis.com/maps/api/js?key="+Vax.Configs.Data.Google.key+"&callback=Vax.initialize",document.body.appendChild(a)})},initialize:function(){"Google"===Vax.Configs.Source?$.when($.getJSON("https://sheets.googleapis.com/v4/spreadsheets/"+Vax.Configs.Data.Google.sheet.id+"/values/"+Vax.Configs.Data.Google.sheet.values+"?majorDimension="+Vax.Configs.Data.Google.sheet.majorDimension+"&key="+Vax.Configs.Data.Google.key,function(a){var b=a.values.shift();Vax.Events=a.values.map(function(a){return b.reduce(function(b,c,d){return b[c]=a[d],b},{})}),Vax.setMoment()})).then(Vax.setMap):"CityOfChicago"===Vax.Configs.Source?$.when($.getJSON(Vax.Configs.Data.CityOfChicago.url,function(a){for(var b=0;b<a.length;b++)for(var c=Object.keys(Vax.Configs.Data.CityOfChicago.alias),d=0;d<c.length;d++)void 0===a[b][Vax.Configs.Data.CityOfChicago.alias[c[d]]]?a[b][c[d]]="":"Latitude"===c[d]?a[b][c[d]]=a[b][Vax.Configs.Data.CityOfChicago.alias[c[d]]].coordinates[1]:"Longitude"===c[d]?a[b][c[d]]=a[b][Vax.Configs.Data.CityOfChicago.alias[c[d]]].coordinates[0]:"BeginDate"===c[d]||"EndDate"===c[d]?a[b][c[d]]=moment(a[b][Vax.Configs.Data.CityOfChicago.alias[c[d]]]).format("M/D/YYYY"):"BeginTime"===c[d]||"EndTime"===c[d]?a[b][c[d]]=moment(a[b][Vax.Configs.Data.CityOfChicago.alias[c[d]]],"HH:mm:ss").format("h:mm:ss A"):a[b][c[d]]=a[b][Vax.Configs.Data.CityOfChicago.alias[c[d]]];Vax.Events=a,Vax.setMoment()})).then(Vax.setMap):alert("No valid data source identified."),$("#header-brand").text(Vax.Configs.Brand.header),""===Vax.Configs.Brand.footerURL?$("#footer-brand").text(Vax.Configs.Brand.footer):$("#footer-brand").html('<a id="footer-brand-link" href="'+Vax.Configs.Brand.footerURL+'" target="_blank">'+Vax.Configs.Brand.footer+"</a>"),$("#help").on("click",function(){$("#modal-help-title").html(Vax.Configs.Modal.help.title),$("#modal-help-body-instructions").html(Vax.Configs.Modal.help.instructions),$("#modal-help").modal("show"),gtag("event","Button",{event_label:"Help",event_category:"Open help text"})}),$("#about").on("click",function(){$("#modal-about-title").html(Vax.Configs.Modal.about.title),$("#modal-about-body-instructions").html(Vax.Configs.Modal.about.instructions),$("#modal-about").modal("show"),gtag("event","Button",{event_label:"About",event_category:"Open about text"})}),$("#search").on("click",function(){"Search"===$("#search").text()?($("#modal-search-title").html(Vax.Configs.Modal.search.title),$("#modal-search-body-instructions").html(Vax.Configs.Modal.search.instructions),$("#modal-search").modal("show"),gtag("event","Button",{event_label:"Search",event_category:"Open search modal"})):gtag("event","Button",{event_label:"Reset",event_category:"Reset map markers"}),Vax.resetMarkers()}),$("#modal-search-search").on("click",function(){""==$("#modal-search-date").val()&&$("#modal-search-date").val(moment().format("ddd, LL")),Vax.searchByDate(moment($("#modal-search-date").val(),"ddd, LL"),null),gtag("event","Button",{event_label:"Search",event_category:$("#modal-search-date").val()})}),$("#modal-search-today").on("click",function(){var a=moment(moment().format("L"),"L");$("#modal-search-date").val(a.format("ddd, LL")),Vax.searchByDate(a,null),gtag("event","Button",{event_label:"Search",event_category:"Today"})}),$("#modal-search-tomorrow").on("click",function(){var a=moment(moment().add(1,"days").format("L"),"L");$("#modal-search-date").val(a.format("ddd, LL")),Vax.searchByDate(a,null),gtag("event","Button",{event_label:"Search",event_category:"Tomorrow"})}),$("#modal-search-weekend").on("click",function(){var a=moment(moment().isoWeekday("Saturday").format("L"),"L"),b=moment(moment().isoWeekday("Sunday").format("L"),"L");$("#modal-search-date").val(a.format("ddd, LL")),Vax.searchByDate(a,b),gtag("event","Button",{event_label:"Search",event_category:"Weekend"})}),$("#modal-search-free").on("click",function(){for(Vax.i=0;Vax.i<Vax.Events.length;Vax.i++){var a=!1;Vax.Events[Vax.i].CostText.indexOf("No cost")>-1&&(a=!0),!1===a&&Vax.Markers[Vax.i].setVisible(!1)}$("#search").html("Reset").removeClass("btn-custom").addClass("btn-danger"),gtag("event","Button",{event_label:"Search",event_category:"Free Events"})}),$("#modal-search-date,#modal-search-date-append").datetimepicker({format:"ddd, LL",ignoreReadonly:!0})},setMoment:function(){for(Vax.i=0;Vax.i<Vax.Events.length;Vax.i++)Vax.Events[Vax.i].MomentBeginDate=moment(Vax.Events[Vax.i].BeginDate,"l"),Vax.Events[Vax.i].MomentEndDate=moment(Vax.Events[Vax.i].EndDate,"l"),Vax.Events[Vax.i].MomentBeginTime=moment(Vax.Events[Vax.i].BeginTime,"h:mm:ss A"),Vax.Events[Vax.i].MomentEndTime=moment(Vax.Events[Vax.i].EndTime,"h:mm:ss A")},setMap:function(){for(Vax.Map=new google.maps.Map(document.getElementById("map"),{zoom:Vax.Configs.Map.zoom,center:Vax.Configs.Map.center,styles:Vax.Configs.Map.styles,clickableIcons:Vax.Configs.Map.clickableIcons,mapTypeControl:Vax.Configs.Map.mapTypeControl,panControl:Vax.Configs.Map.panControl,streetViewControl:Vax.Configs.Map.streetViewControl,zoomControl:Vax.Configs.Map.zoomControl,maxZoom:Vax.Configs.Map.maxZoom,minZoom:Vax.Configs.Map.minZoom,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},fullscreenControl:Vax.Configs.Map.fullscreenControl}),Vax.i=0;Vax.i<Vax.Events.length;Vax.i++)Vax.Events[Vax.i].MomentEndDate.isBefore(moment())?Vax.Markers[Vax.i]=new google.maps.Marker({position:new google.maps.LatLng(Vax.Events[Vax.i].Latitude,Vax.Events[Vax.i].Longitude),map:Vax.Map,icon:{url:"img/grey.png",scaledSize:new google.maps.Size(32,32)},opacity:.67}):Vax.Events[Vax.i].CostText.indexOf("No cost")>-1?Vax.Markers[Vax.i]=new google.maps.Marker({position:new google.maps.LatLng(Vax.Events[Vax.i].Latitude,Vax.Events[Vax.i].Longitude),map:Vax.Map,icon:{url:"img/red.png",scaledSize:new google.maps.Size(32,32)}}):Vax.Markers[Vax.i]=new google.maps.Marker({position:new google.maps.LatLng(Vax.Events[Vax.i].Latitude,Vax.Events[Vax.i].Longitude),map:Vax.Map,icon:{url:"img/blue.png",scaledSize:new google.maps.Size(32,32)}}),google.maps.event.addListener(Vax.Markers[Vax.i],"click",function(a,b){return function(){$("#modal-event-detail-title").html(Vax.Events[b].LocationName);var a="";Vax.Events[b].MomentEndDate.isBefore(moment())&&(a+='<div class="alert alert-danger" role="alert">This date of this event has passed. Look for red or blue event pins on the map.</div>'),a+="<p>"+Vax.Events[b].Address1,""!==Vax.Events[b].Address2.trim()&&(a+=" "+Vax.Events[b].Address2),a+="<br>"+Vax.Events[b].City+", "+Vax.Events[b].State+" "+Vax.Events[b].PostalCode,""===Vax.Events[b].Phone&&""===Vax.Events[b].Contact||(a+="<br>",""!==Vax.Events[b].Contact&&(a+="Contact: "+Vax.Events[b].Contact),""!==Vax.Events[b].Phone&&""!==Vax.Events[b].Contact&&(a+=" at "),""!==Vax.Events[b].Phone&&(a+="<strong>"+Vax.Events[b].Phone+"</strong>")),""!==Vax.Events[b].Url&&(a+='<br><a href="'+Vax.Events[b].Url+'" target="_blank">'+Vax.Events[b].Url+"</a>"),Vax.Events[b].BeginDate===Vax.Events[b].EndDate?(a+="<hr>"+Vax.Events[b].MomentBeginDate.format("dddd, MMMM Do, YYYY"),a+="<br>Hours: "+Vax.Events[b].MomentBeginTime.format("h:mm A")+" to "+Vax.Events[b].MomentEndTime.format("h:mm A"),Vax.Cal[b]=ics(),Vax.Cal[b].addEvent(Vax.Events[b].LocationName,Vax.Events[b].CostText+" "+Vax.Events[b].Contact+" "+Vax.Events[b].Phone+" "+Vax.Events[b].Url,Vax.Events[b].Address1+" "+Vax.Events[b].Address2+" "+Vax.Events[b].City+", "+Vax.Events[b].State+" "+Vax.Events[b].PostalCode,Vax.Events[b].MomentBeginDate.format("M/D/YYYY")+" "+Vax.Events[b].MomentBeginTime.format("h:mm a"),Vax.Events[b].MomentEndDate.format("M/D/YYYY")+" "+Vax.Events[b].MomentEndTime.format("h:mm a")),$("#modal-event-detail-ical").show().on("click",function(){Vax.Cal[b].download(),gtag("event","Button",{event_label:"Add To Calendar",event_category:Vax.Events[b].LocationName+" - "+Vax.Events[b].MomentBeginDate.format("M/D/YYYY")})})):(a+="<hr>"+Vax.Events[b].HoursText,$("#modal-event-detail-ical").hide().off()),a+="<hr>"+Vax.Events[b].CostText,a+="</p>",$("#modal-event-detail-body").html(a),$("#modal-event-detail").modal("show"),gtag("event","Modal",{event_label:"Vaccination Detail",event_category:Vax.Events[b].LocationName+" - "+Vax.Events[b].Address1+" "+Vax.Events[b].Address2+" "+Vax.Events[b].City+", "+Vax.Events[b].State+" "+Vax.Events[b].PostalCode})}}(Vax.Markers[Vax.i],Vax.i));if(navigator.geolocation){var a=document.createElement("div");Vax.setFindMeControl(a),a.index=1,Vax.Map.controls[google.maps.ControlPosition.TOP_LEFT].push(a)}},setFindMeControl:function(a){a.className+="find-me-div";var b=document.createElement("div");b.className+="find-me-ui",b.title="Click to find your location.",a.appendChild(b);var c=document.createElement("div");c.className+="find-me-text",c.innerHTML="Find Me",b.appendChild(c);var d=new google.maps.Geocoder;google.maps.event.addDomListener(b,"click",function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){var b=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);d.geocode({location:b},function(a,b){if("OK"===b&&a instanceof Array)for(var c=0;a[0].address_components.length;c++)if(a[0].address_components[c].types.includes("postal_code")){gtag("event","Button",{event_label:"Find Me",event_category:a[0].address_components[c].short_name});break}}),Vax.Map.setCenter(b),Vax.Map.setZoom(Vax.Configs.Map.zoom),null===Vax.AddressMarker?Vax.AddressMarker=new google.maps.Marker({position:b,map:Vax.Map,icon:{url:"img/yellow.png",scaledSize:new google.maps.Size(32,32)},clickable:!1}):(Vax.AddressMarker.setPosition(b),null===Vax.AddressMarker.getMap()&&Vax.AddressMarker.setMap(Map.Map))},function(){alert("We're sorry. We could not find you. Please type in an address.")},{timeout:5e3,enableHighAccuracy:!0})})},searchByDate:function(a,b){for(Vax.i=0;Vax.i<Vax.Events.length;Vax.i++){var c=!1,d=moment(Vax.Events[Vax.i].BeginDate,"l"),e=moment(Vax.Events[Vax.i].EndDate,"l");if(a.isBetween(d,e,null,"[]"))if(0===Vax.Events[Vax.i].RecurrenceDays.length)c=!0;else for(var f=Vax.Events[Vax.i].RecurrenceDays.split(","),g=0;g<f.length;g++)if(Vax.matchDays(a,f[g].replace(/ /g,""))){c=!0;break}if(!1===c&&null!==b&&b.isBetween(d,e,null,"[]"))if(0===Vax.Events[Vax.i].RecurrenceDays.length)c=!0;else for(var h=Vax.Events[Vax.i].RecurrenceDays.split(","),i=0;i<h.length;i++)if(Vax.matchDays(b,h[i].replace(/ /g,""))){c=!0;break}!1===c&&Vax.Markers[Vax.i].setVisible(!1)}$("#search").html("Reset").removeClass("btn-custom").addClass("btn-danger")},matchDays:function(a,b){switch(b){case a.format("dddd"):case a.format("ddd"):case a.format("dd"):return!0;default:return!1}},resetMarkers:function(){for(Vax.i=0;Vax.i<Vax.Events.length;Vax.i++)Vax.Markers[Vax.i].setVisible(!0);$("#search").html("Search").removeClass("btn-danger").addClass("btn-custom"),$("#modal-search-date").val("")}};window.onload=Vax.loadScript;